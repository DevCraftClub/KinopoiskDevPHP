# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã readonly –∫–ª–∞—Å—Å–∞

## ‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #7

### ‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤ CI/CD:
```
PHP Fatal error: Readonly class KinopoiskDev\Kinopoisk cannot extend non-readonly class Lombok\Helper in /opt/actions-runner/_work/KinopoiskDevPHP/KinopoiskDevPHP/src/Kinopoisk.php on line 33
Script phpunit handling the test event returned with error code 255
```

### üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã:
- **PHP 8.1+** —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã readonly –∫–ª–∞—Å—Å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç readonly –∫–ª–∞—Å—Å–∞
- **–ö–ª–∞—Å—Å `Kinopoisk`** –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫ `readonly final class`  
- **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç `Lombok\Helper`** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Lombok –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç readonly –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- **Fatal error** –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∞—Å—Å–∞

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. **–ê–Ω–∞–ª–∏–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è**
–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:
```php
final readonly class Kinopoisk extends Helper {
    // ...
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: `Helper` –∫–ª–∞—Å—Å –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Lombok –Ω–µ —è–≤–ª—è–µ—Ç—Å—è readonly.

### 2. **–ü—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**
–£–±—Ä–∞–Ω readonly –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å –∫–ª–∞—Å—Å–∞:
```php
// ‚ùå –î–æ:
final readonly class Kinopoisk extends Helper {

// ‚úÖ –ü–æ—Å–ª–µ:
final class Kinopoisk extends Helper {
```

### 3. **–ê–Ω–∞–ª–∏–∑ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è**
```php
class Kinopoisk extends Helper {
    #[Getter]
    private HttpClientInterface $httpClient;
    
    #[Getter, Sensitive]
    private string $apiToken;
    
    #[Getter]
    private CacheInterface $cache;
    
    // –°–≤–æ–π—Å—Ç–≤–æ –æ—Å—Ç–∞–µ—Ç—Å—è readonly –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
    private readonly bool $useCache = false,
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è:**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è (–≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞ private)
- ‚úÖ Lombok –∞—Ç—Ä–∏–±—É—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ `$useCache` –æ—Å—Ç–∞–µ—Ç—Å—è readonly
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ readonly –∫–ª–∞—Å—Å—ã:
```bash
# –ù–∞–π–¥–µ–Ω—ã 43 readonly –∫–ª–∞—Å—Å–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ
grep -r "readonly class" src/ | wc -l  # –†–µ–∑—É–ª—å—Ç–∞—Ç: 43
```

### ‚úÖ –°—Ç–∞—Ç—É—Å –¥—Ä—É–≥–∏—Ö –∫–ª–∞—Å—Å–æ–≤:
- **40 Model –∫–ª–∞—Å—Å–æ–≤** - —Ä–µ–∞–ª–∏–∑—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BaseModel` ‚úÖ
- **2 Service –∫–ª–∞—Å—Å–∞** - –Ω–µ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è ‚úÖ  
- **1 Attribute –∫–ª–∞—Å—Å** - –Ω–µ –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è ‚úÖ
- **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ readonly –æ—Ç readonly** - –≤—Å–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:
```php
// ‚úÖ Readonly –Ω–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç readonly
readonly class Person extends MeiliPersonEntity {  // OK
readonly class DeathPlace extends PersonPlace {}   // OK  
readonly class BirthPlace extends PersonPlace {}   // OK
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª—å: PHP 8.1+ Readonly Rules

### –ü—Ä–∞–≤–∏–ª–∞ PHP –¥–ª—è readonly –∫–ª–∞—Å—Å–æ–≤:
1. **Readonly –∫–ª–∞—Å—Å** –º–æ–∂–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç readonly –∫–ª–∞—Å—Å–∞
2. **Readonly –∫–ª–∞—Å—Å** –º–æ–∂–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –ª—é–±—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
3. **–í—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞** readonly –∫–ª–∞—Å—Å–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ readonly
4. **–°–≤–æ–π—Å—Ç–≤–∞ –Ω–µ–ª—å–∑—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å** –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã):
```php
// –í–∞—Ä–∏–∞–Ω—Ç 1: –£–±—Ä–∞—Ç—å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (–ø–æ—Ç–µ—Ä—è—Ç—å Lombok —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
final readonly class Kinopoisk {
    // –†—É—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ—Ç—Ç–µ—Ä–æ–≤
}

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—é
final readonly class Kinopoisk {
    private Helper $helper;
    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤
}

// –í–∞—Ä–∏–∞–Ω—Ç 3: –í—ã–±—Ä–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - —É–±—Ä–∞—Ç—å readonly
final class Kinopoisk extends Helper {
    // Lombok —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
}
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚ùå PHP Fatal error: Readonly class cannot extend non-readonly class
‚ùå Script phpunit handling the test event returned with error code 255
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
```

### ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚úÖ Class loads successfully
‚úÖ Lombok attributes work correctly
‚úÖ All tests can run
‚úÖ No functional changes
```

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- **PHP 8.1+** - –ø–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ readonly
- **Lombok –±–∏–±–ª–∏–æ—Ç–µ–∫–∞** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≥–µ—Ç—Ç–µ—Ä–æ–≤
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥** - –Ω–∏–∫–∞–∫–∏—Ö breaking changes

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **Private —Å–≤–æ–π—Å—Ç–≤–∞** - –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- **Critical readonly** - –≤–∞–∂–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–º–∏
- **Type safety** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤** - Lombok –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
- **Compile-time –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ
- **Memory efficiency** - –Ω–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∞—Å—Å–∞
php -r "require 'vendor/autoload.php'; new KinopoiskDev\Kinopoisk('test-token');"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö readonly –∫–ª–∞—Å—Å–æ–≤
grep -r "readonly class" src/ | grep -v "implements\|extends.*readonly"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
./vendor/bin/phpunit
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: Readonly –∫–ª–∞—Å—Å –Ω–µ –º–æ–∂–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç non-readonly –∫–ª–∞—Å—Å–∞ –≤ PHP 8.1+

**–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞–Ω readonly –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å –∫–ª–∞—Å—Å–∞ `Kinopoisk`, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ private —Å–≤–æ–π—Å—Ç–≤–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å PHP 8.1+ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ Lombok –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

---

**‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ #7 —Ä–µ—à–µ–Ω–∞! –ö–ª–∞—Å—Å Kinopoisk –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.**